<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Educativo - KidsPlay</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Comic Sans MS', cursive;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        .game-header {
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .game-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .controls-info {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        #gameCanvas {
            border: 4px solid white;
            border-radius: 10px;
            background: #2c3e50;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
        
        .game-info {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            color: white;
            font-size: 1.2rem;
        }
        
        .score-display, .level-display {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            display: none;
        }
        
        .restart-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <a href="../../../index.html" class="back-button" id="backToCatalog">
        ‚Üê Torna ai Giochi
    </a>
    
    <div class="game-header">
        <h1>üêç Snake Educativo</h1>
        <div class="controls-info">
            <p><strong>Controlli:</strong> Usa le frecce ‚¨ÖÔ∏è‚û°Ô∏è‚¨ÜÔ∏è‚¨áÔ∏è o il gamepad per muoverti!</p>
            <p>Raccogli le mele rosse üçé e cresci!</p>
        </div>
    </div>
    
    <canvas id="gameCanvas" width="600" height="400"></canvas>
    
    <div class="game-info">
        <div class="score-display">
            üçé Punteggio: <span id="score">0</span>
        </div>
        <div class="level-display">
            ‚ö° Velocit√†: <span id="level">Facile</span>
        </div>
    </div>
    
    <div class="game-over" id="gameOverDialog">
        <h2>üéâ Ottimo lavoro!</h2>
        <p>Hai raccolto <span id="finalScore">0</span> mele!</p>
        <button class="restart-button" onclick="restartGame()">Gioca ancora! üöÄ</button>
    </div>

    <script>
        // Snake Educational Game - Kid-friendly version
        class SnakeGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gridSize = 20;
                this.tileCount = this.canvas.width / this.gridSize;
                
                // Game state
                this.snake = [{x: 10, y: 10}];
                this.food = this.generateFood();
                this.dx = 0;
                this.dy = 0;
                this.score = 0;
                this.isPlaying = false;
                this.gameSpeed = 200; // Kid-friendly slow speed
                
                this.init();
            }
            
            init() {
                this.setupControls();
                this.gameLoop();
                this.startInstructions();
            }
            
            startInstructions() {
                this.ctx.fillStyle = '#2c3e50';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.ctx.fillStyle = 'white';
                this.ctx.font = '24px Comic Sans MS';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('Premi una freccia per iniziare!', this.canvas.width/2, this.canvas.height/2);
                this.ctx.textAlign = 'left';
            }
            
            setupControls() {
                document.addEventListener('keydown', (e) => {
                    if (!this.isPlaying) this.isPlaying = true;
                    
                    switch(e.code) {
                        case 'ArrowUp':
                        case 'KeyW':
                            if (this.dy === 0) { 
                                this.dx = 0; 
                                this.dy = -1; 
                                this.playSound('move');
                            }
                            break;
                        case 'ArrowDown':
                        case 'KeyS':
                            if (this.dy === 0) { 
                                this.dx = 0; 
                                this.dy = 1; 
                                this.playSound('move');
                            }
                            break;
                        case 'ArrowLeft':
                        case 'KeyA':
                            if (this.dx === 0) { 
                                this.dx = -1; 
                                this.dy = 0; 
                                this.playSound('move');
                            }
                            break;
                        case 'ArrowRight':
                        case 'KeyD':
                            if (this.dx === 0) { 
                                this.dx = 1; 
                                this.dy = 0; 
                                this.playSound('move');
                            }
                            break;
                    }
                });
                
                // Gamepad support
                this.checkGamepad();
            }
            
            checkGamepad() {
                const gamepads = navigator.getGamepads();
                if (gamepads[0]) {
                    const gp = gamepads[0];
                    
                    // D-pad controls
                    if (gp.buttons[12] && gp.buttons[12].pressed && this.dy === 0) {
                        this.dx = 0; this.dy = -1; this.isPlaying = true;
                    }
                    if (gp.buttons[13] && gp.buttons[13].pressed && this.dy === 0) {
                        this.dx = 0; this.dy = 1; this.isPlaying = true;
                    }
                    if (gp.buttons[14] && gp.buttons[14].pressed && this.dx === 0) {
                        this.dx = -1; this.dy = 0; this.isPlaying = true;
                    }
                    if (gp.buttons[15] && gp.buttons[15].pressed && this.dx === 0) {
                        this.dx = 1; this.dy = 0; this.isPlaying = true;
                    }
                }
                
                // Continue checking
                requestAnimationFrame(() => this.checkGamepad());
            }
            
            generateFood() {
                let newFood;
                do {
                    newFood = {
                        x: Math.floor(Math.random() * this.tileCount),
                        y: Math.floor(Math.random() * this.tileCount)
                    };
                } while (this.snake.some(segment => segment.x === newFood.x && segment.y === newFood.y));
                
                return newFood;
            }
            
            gameLoop() {
                if (this.isPlaying) {
                    this.update();
                }
                this.draw();
                
                setTimeout(() => {
                    this.gameLoop();
                }, this.gameSpeed);
            }
            
            update() {
                const head = {x: this.snake[0].x + this.dx, y: this.snake[0].y + this.dy};
                
                // Wrap around edges instead of game over (kid-friendly)
                head.x = (head.x + this.tileCount) % this.tileCount;
                head.y = (head.y + this.tileCount) % this.tileCount;
                
                // Check self collision (but make it forgiving)
                const selfCollision = this.snake.some(segment => segment.x === head.x && segment.y === head.y);
                if (selfCollision && this.snake.length > 3) {
                    this.gameOver();
                    return;
                }
                
                this.snake.unshift(head);
                
                // Check food collision
                if (head.x === this.food.x && head.y === this.food.y) {
                    this.score += 10;
                    this.food = this.generateFood();
                    document.getElementById('score').textContent = this.score;
                    this.playSound('collect');
                    
                    // Increase speed slightly (but keep it kid-friendly)
                    if (this.gameSpeed > 120) {
                        this.gameSpeed -= 5;
                    }
                } else {
                    this.snake.pop();
                }
            }
            
            draw() {
                // Clear canvas with gradient
                const gradient = this.ctx.createLinearGradient(0, 0, this.canvas.width, this.canvas.height);
                gradient.addColorStop(0, '#2c3e50');
                gradient.addColorStop(1, '#34495e');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw grid (subtle)
                this.ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                this.ctx.lineWidth = 1;
                for (let i = 0; i <= this.tileCount; i++) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(i * this.gridSize, 0);
                    this.ctx.lineTo(i * this.gridSize, this.canvas.height);
                    this.ctx.stroke();
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, i * this.gridSize);
                    this.ctx.lineTo(this.canvas.width, i * this.gridSize);
                    this.ctx.stroke();
                }
                
                // Draw snake with gradient
                this.snake.forEach((segment, index) => {
                    const alpha = 1 - (index * 0.1);
                    this.ctx.fillStyle = `rgba(39, 174, 96, ${Math.max(alpha, 0.3)})`;
                    this.ctx.fillRect(
                        segment.x * this.gridSize + 1, 
                        segment.y * this.gridSize + 1, 
                        this.gridSize - 2, 
                        this.gridSize - 2
                    );
                    
                    // Draw snake head eyes
                    if (index === 0) {
                        this.ctx.fillStyle = 'white';
                        this.ctx.beginPath();
                        this.ctx.arc(segment.x * this.gridSize + 6, segment.y * this.gridSize + 6, 2, 0, Math.PI * 2);
                        this.ctx.arc(segment.x * this.gridSize + 14, segment.y * this.gridSize + 6, 2, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                });
                
                // Draw food with pulsing effect
                const pulse = Math.sin(Date.now() * 0.01) * 0.2 + 0.8;
                this.ctx.fillStyle = `rgba(231, 76, 60, ${pulse})`;
                this.ctx.fillRect(
                    this.food.x * this.gridSize + 2, 
                    this.food.y * this.gridSize + 2, 
                    this.gridSize - 4, 
                    this.gridSize - 4
                );
                
                // Draw apple emoji on food
                this.ctx.font = '16px Arial';
                this.ctx.fillText('üçé', this.food.x * this.gridSize + 2, this.food.y * this.gridSize + 16);
            }
            
            playSound(type) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    if (type === 'collect') {
                        oscillator.frequency.value = 523; // C5
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.2);
                    } else if (type === 'move') {
                        oscillator.frequency.value = 200;
                        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.1);
                    }
                } catch (e) {
                    // Ignore audio errors
                }
            }
            
            gameOver() {
                this.isPlaying = false;
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('gameOverDialog').style.display = 'block';
            }
        }
        
        // Initialize game
        let game = new SnakeGame();
        
        function restartGame() {
            document.getElementById('gameOverDialog').style.display = 'none';
            game = new SnakeGame();
            document.getElementById('score').textContent = '0';
        }
        
        // Touch controls for mobile
        let touchStartX = 0;
        let touchStartY = 0;
        
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });
        
        document.addEventListener('touchend', (e) => {
            if (!touchStartX || !touchStartY) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            
            if (Math.abs(deltaX) > Math.abs(deltaY)) {
                // Horizontal swipe
                if (deltaX > 30 && game.dx === 0) {
                    game.dx = 1; game.dy = 0; game.isPlaying = true;
                } else if (deltaX < -30 && game.dx === 0) {
                    game.dx = -1; game.dy = 0; game.isPlaying = true;
                }
            } else {
                // Vertical swipe
                if (deltaY > 30 && game.dy === 0) {
                    game.dx = 0; game.dy = 1; game.isPlaying = true;
                } else if (deltaY < -30 && game.dy === 0) {
                    game.dx = 0; game.dy = -1; game.isPlaying = true;
                }
            }
            
            touchStartX = 0;
            touchStartY = 0;
        });
    </script>
</body>
</html>
